# TURNtoURN

## Transformation from TURN to URN using ATL
  
**ATL -** Phase 1 of transformation. Turn2Urn.atl is the primary transformation file and **uses** ConnectNodes.atl using Module Superimposition  
  
**Input -** TURN model saved in .xml format (sample file provided)  
  
**Output -** .jucm output generated by transformation  
  
**Metamodels -** Turn.ecore    
  
**Expected Outputs -** expected output .jucm files for all test cases  
  
**Turn2UrnPhase2.java -** Phase 2 of transformation 

## TODO
* Refactor for increased readability
	* Rearrange methods so that their order feels more natural.
	* Change names of variables that are single letters (in particular, haven't handled this in the case of parameters for called rules)
* Refactor for increased consistency
	* All if and else loops, including single line ones, should have braces
	* Decide on a naming convention for source and target model elements. Either stick to s and t or have the names be descriptive.
	* Need consistency with whether empty from / to items have () or not
	* Decide if all conditionals should have an else loop that explicitly states the else case should not be entered in valid method calls
		* Determine if error messages can be sent out by ATL in these cases
	* Make all caps variable names into camel case (all caps was for refactoring purposes to make variable names easier to find)
	* Make sure all select(n.name='') are consistent in (Turn2Urn remains)
* Consider writing a getFromSequenceByName method
* Look at all uses of -> including and -> union to see if they are behaving correctly
	* Look to see if any other places should have -> including or -> union called instead of simple assignments
* Determine why we pass along tUCMmap rather than storing it in a global variable like OrForkMap, AndForkMap; pick one convention to stick to.
* Make sure all typings are correct; I'm worried that sometimes we pass in a sequence to a method that takes in a single value as an argument (e.g., collectRegularEnds)
* Verify that all calls to methods I've created match the logic of the original system
* Verify if cases in which 'succeeded' logic is used to handle nested conditionals are all correct (i.e., make sure none of the nested ifs were intentional to avoid the else)
* Verify the lifetime of variables to make sure they aren't sitting around eternally
* Make variable name orderings in method arguments consistent
* Rename methods so that their names describe their behavior better
* Go over all matched rules to make sure assignments are from Urn object to Urn object (i.e., that resolveTemps are used where appropriate)
* Untangle the thisModule.counter logic so that it isn't spread out in random places in Turn2Urn and ConnectNodes and so it no longer uses a global variable counter
* Make sure that no issues are occurring because tUCMmap is only updated in UCMmap2UCMmap; this seems highly likely to cause issues with tUCMmap.getNode() calls 
* Look to see if there is a way to remove any or all map global objects
* Rename any Urn object variable names to start with a 't' for consistency and clarity and Turn object variable names with an 's'
* Rename variable names in 'using' blocks with a better convention
* Write down the return type for each called rule
* Make all "using" variables start with v, all argument variables with a, source object with s, target object with t
* Put in an INIT (varname) for all initializations for variables for readability
* Verify ordering of operations that add nodes to tUCMmap in create called rules (e.g., createTimer) is correct

## ACTIVE TASK
I am currently troubleshooting the code to look for issues that cause either incorrect outputs or runtime errors.

## ISSUES
1. The test StartPointTestNoName causes an error in UCMmap2UCMmap. This is because the way UCMmap2UCMmap is currently written means a StartPoint must exist.
2. The test EndPointTestNoName causes an error in UCMmap2UCMmap. This is because the way UCMmap2UCMmap is currently written means all PathEnds must have a RegularEnd in them. The specific line in endpoint.xml reads:
	```
	<pathBody xsi:type="turn:PathBodyNodes">
		<pathEnd xsi:type="turn:EndpointWithConnect"/>
	</pathBody>
	```
After noting the above, I looked at startpoint.xml as a point of reference. In that, no StartPoint is created at all. This actually causes the first bug, listed above. That brings three cases to mind:
* EndPointTestNoName should have no EndPointWithConnect to match the behavior shown in StartPointTestNoName
* StartPointTestNoName should have a StartPoint with a RegularEnd with some default name, and so EndPointTestNoName should have the same.
* The EndPointWithConnect without a RegularEnd should be handled somewhere in the code, and StartPointNoName should create a StartPoint with no RegularEnd which is also handled somewhere else in the code.
3. In the rules InBinding2InBinding and OutBinding2OutBinding, there is an attempt to retrieve an item from the stubMap which is not in the stubMap. I have not yet pinpointed the source of this issue beyond what lines it occurs in.		